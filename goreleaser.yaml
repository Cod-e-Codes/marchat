version: 2

project_name: marchat

builds:
  - id: server
    main: ./cmd/server/main.go
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
    binary: marchat-server
    env:
      - CGO_ENABLED=0
    ldflags:
      - -s -w
    flags:
      - -mod=readonly

  - id: client
    main: ./client/main.go
    goos:
      - linux
      - windows
      - darwin
    goarch:
      - amd64
    binary: marchat-client
    env:
      - CGO_ENABLED=0
    ldflags:
      - -s -w
    flags:
      - -mod=readonly

archives:
  - id: archive
    builds:
      - server
      - client
    format: tar.gz
    name_template: "{{ .ProjectName }}_{{ .Version }}_{{ if eq .Os \"darwin\" }}macOS{{ else }}{{ .Os }}{{ end }}_{{ .Arch }}"
    files:
      - LICENSE
      - README.md
      - config.json

checksum:
  name_template: "checksums.txt"
  algorithm: sha256

snapshot:
  name_template: "{{ .Tag }}-snapshot"

changelog:
  use: git

release:
  draft: false
  prerelease: false
  github:
    owner: Cod-e-Codes
    name: marchat

before:
  hooks:
    - rm -rf dist
